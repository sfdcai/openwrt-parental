#!/usr/bin/lua
-- rpcd plugin providing parental.* methods
local json=require"luci.jsonc"
local function sh(c) local f=io.popen(c.." 2>&1");local o=f:read("*a");f:close();return o end
local M,methods={},{}
methods.get_overview={args={},call=function()return 0,{uci=sh("uci -q show parental") }end}
methods.apply={args={},call=function()return 0,{out=sh("/usr/share/parental/scripts/apply.sh reload") }end}
methods.health={args={},call=function()return 0,{out=sh("/usr/share/parental/scripts/health.sh") }end}
methods.sync_adguard={args={},call=function()return 0,{out=sh("/usr/share/parental/scripts/adguard_sync.sh") }end}
function M.list(t)for k,_ in pairs(methods)do table.insert(t,k)end;return 0 end
function M.call(m,a)local f=methods[m];if not f then return 1 end;return f.call(a or {}) end
return M
