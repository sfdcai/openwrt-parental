#!/bin/sh
set -eu

if [ "${PARENTAL_RPCD_DEBUG:-0}" = "1" ]; then
  set -x
fi

find_lua() {
  for bin in ${PARENTAL_LUA_BIN:-} lua lua5.1 lua5.3 luajit; do
    [ -n "$bin" ] || continue
    if command -v "$bin" >/dev/null 2>&1; then
      echo "$bin"
      return 0
    fi
  done
  return 1
}

LUA_BIN="$(find_lua || true)"
if [ -z "$LUA_BIN" ]; then
  echo "[parental] Lua interpreter not found (install lua or lua5.1)" >&2
  exit 1
fi

exec "$LUA_BIN" /usr/libexec/rpcd/parental.lua "$@"
